{#
    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at https://mozilla.org/MPL/2.0/.
#}

{% extends "partials/layout.html" %}
{% block page_title %}Treestatus{% endblock %}

{% block main %}
<main class="Treestatus container fullhd">
    {% include "treestatus/recent_changes.html" %}

    <h1>Treestatus: {{ tree }}</h1>
    {% set current_status = logs[0].status if logs else "open" %}
    <p>Current status: {{ tree }} is <span class="{{ current_status | treestatus_to_status_badge_class }}">{{ current_status }}</span></p>

    <a href="{{ url_for("treestatus.treestatus") }}"><button class="button">Show All Trees</button></a>
    <div class="container">
        {% for log_update_form, log in logs %}
            <!-- TODO put this class on the right field after converting from row -->
            <!-- TODO still looks a tad funky with spacing etc -->
            <form action="{{ url_for("treestatus.update_log", id=log.id) }}" method="post">
                {{ log_update_form.csrf_token }}

                <div class="box log-update-form">
                    <div class="columns">
                        <div class="column is-2">
                            <span class="{{ log.status | treestatus_to_status_badge_class }}">{{ log.status }}</span>
                        </div>
                        <div class="column is-expanded">
                            <div class="block"><b>{{ log.when }}</b></div>
                            <div class="block">{{ log.who }}</div>
                            <div class="block">
                                <p class="log-update-visible">{{ log_update_form.reason.label }}: <b>{{ log.reason }}</b></p>
                                {{ log_update_form.reason(id=id_string, class="log-update-hidden") }}
                                <p class="log-update-visible">{{ log_update_form.reason_category.label }}: <b>{{ log_update_form.reason_category.data }}</b></p>
                                {{ log_update_form.reason_category(id=id_string, class="log-update-hidden") }}
                            </div>
                        </div>
                        <div class="column is-narrow">
                            <button class="button is-small is-primary log-update-edit log-update-visible" type="button">Edit</button>
                            <button class="button is-small is-primary log-update-hidden">Update</button>
                            <button class="button delete is-normal log-update-edit log-update-hidden" type="button"></button>
                        </div>
                    </div>
                </div>
            </form>
        {% endfor %}
    </div>
</main>
{% endblock %}
